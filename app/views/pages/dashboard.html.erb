<div class="container">

  <%# Menu %>
  <div class="card-dashboard-menu">
    <div>
      <% if @user.username %>
        <h1>Hello <%= @user.username.capitalize %>, welcome to your dashboard</h1>
      <% else %>
        <h1> Welcome to your dashboard</h1>
      <% end  %>
    </div>
    <div>
      <%= link_to "Back to list", pets_path, class: "btn btn-primary ms-3" %>
    </div>
  </div>

  <%# Profile %>
  <div class="card-dashboard">
    <div class="card-dashboard-header">
      <h1>My Profile</h1>
      <%= link_to "Edit profile", edit_user_registration_path(@user), class: "btn-green" %>
    </div>
    <div>
      <% if @user.username %>
        <h4>Username</h4>
        <p><%= @user.username.capitalize %></p>
        <h4>Email</h4>
        <p><%= @user.email %></p>
      <% else %>
        <h4>Username</h4>
        <p><%= @user.email %></p>
      <% end %>
      <h4>Address</h4>
      <p><%= @user.address.capitalize %></p>
    </div>
  </div>

  <%# My pets / rajouter _as_owner après pending_booking%>
  <div class="card-dashboard">
    <div class="card-dashboard-header">
      <h1>My Pets</h1>
      <%= link_to "Add a pet", new_pet_path, class: "btn-green" %>
    </div>
    <div class="d-flex">
      <div class="column-60">
        <div class="d-flex justify-content-between">
          <h4>Team</h4>
          <h5><%= @user.pets.all.count %> pets</p>
        </div>
        <div class="user-pets-display">
          <% @user.pets.all.each do |pet| %>
            <div class="user-pet-card">
              <div class="card-index-photo">
                <% if pet.photos.any? %>
                  <%= cl_image_tag pet.photos.first.key %>
                <% end %>
              </div>
              <div class="user-pet-card-info">
                <h4><%= pet.name %></h4>
                <p><%= pet.specie %></p>
                <p><strong>€<%= pet.price %></strong> / day</p>
                <div class="d-flex flex-row justify-content-between mt-4">
                  <%= link_to "", edit_pet_path(pet), class:"links far fa-edit" %>
                  <%= link_to "", pet_path(pet), class:"links fas fa-eye" %>
                  <%= link_to "", pet_path(pet), class: "links fas fa-trash", method: :delete, data: { confirm: "Are you sure?" } %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <div class="column-40 scroll">
        <div class="d-flex justify-content-between">
          <h4>Bookings</h4>
          <h5><%= @user.bookings.all.count %> total | <%= @user.bookings.pending.count %> pending</p>
        </div>
        <div class="owner-bookings-display">
          <% @user.bookings.all.each do |booking| %>
          <div class="owner-booking-card">
            <% if booking.pet.photos.any? %>
              <%= cl_image_tag booking.pet.photos.first.key %>
            <% end %>
            <div class="info">
              <h4><%= Pet.find(booking.pet_id).name %></h4>
              <p>Requested by <%= User.find(booking.user_id).username.capitalize %></p>
              <p><%= booking.starting_date.strftime("%a %e %b %y") %> - <%= booking.ending_date.strftime("%a %e %b %y") %></p>
            </div>
            <div class="status">
              <% if booking.pending? %>
                <p id="pending"><%= "Confirm?" %></p>
                <div class="d-flex justify-content-between">
                  <i class="fa-solid fa-xmark m-3" style="color: red"></i>
                  <i class="fa-solid fa-check m-3" style="color: green"></i>
                </div>
              <% elsif booking.accepted?%>
                <p id="confirmed"><%= "Confirmed" %></p>
              <% else %>
                <p id="rejected"><%= "Rejected" %></p>
              <% end %>
            </div>
          </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <%# My Bookings %>
  <div class="card-dashboard">
    <div class="card-dashboard-header">
      <h1>My Bookings</h1>
      <%= link_to "Book a pet", pets_path, class: "btn-green" %>
    </div>
    <div class="user-bookings-display">
      <% @user.bookings.all.each do |booking| %>
        <div class="user-pet-card">
          <div class="card-index-photo">
            <% if booking.pet.photos.any? %>
              <%= cl_image_tag booking.pet.photos.first.key %>
            <% end %>
          </div>
          <div class="info">
            <h4><%= booking.pet.name %></h4>
            <p><%= booking.pet.specie %></p>
            <p>Owned by <%= booking.pet.user.username.capitalize %></p>
            <%# <p>Period: <%= booking.starting_date.strftime("%a %e %b %y") - <%= booking.ending_date.strftime("%a %e %b %y") (days)</p> %>
            <%# <p>Total price: €<%= booking.pet.price * (booking.ending_date.strftime("%a %e %b %y") - booking.starting_date.strftime("%a %e %b %y"))</p> %>
            <div class="d-flex flex-row justify-content-between mt-4">
              <%# <%= link_to "", edit_pet_path(pet), class:"links far fa-edit" %>
              <%# <%= link_to "", pet_path(pet), class:"links fas fa-eye" %>
              <%# <%= link_to "", pet_path(pet), class: "links fas fa-trash", method: :delete, data: { confirm: "Are you sure?" } %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

</div>



<%# CODE ETIENNE %>

  <%# <div class="pending card-dashboard"> %>
    <%# <div class="card-dashboard-header"> %>
      <%# <h1>Your pending bookings as a user (<%= @pending_bookings.count)</h1> %>
    <%# </div>
    <h3>Here is the list of your bookings waiting to be confirmed by the pet owner</h3> %>
    <%# <% @pending_bookings.each do |pending_booking| %>
      <%# <div class="card-pending-booking border"> %>
        <%# <h4>- Waiting for <%= pending_booking.pet.user.username to confirm your booking of <%= Pet.find(pending_booking.pet_id).name</h4>
      </div> %>
    <%# <% end %>
  <%# </div> %>

  <%# <div class="card-dashboard"> %>
    <%# <h1>Your pending bookings as an owner(<%= @pending_bookings_as_owner.count)</h1> %>
    <%# <h3>You have <%= @pending_bookings_as_owner.count bookings requests to answer to:</h3> %>
    <%# <% @pending_bookings_as_owner.each do |pending_booking_as_owner| %>
      <%# <div class="border"> %>
        <%# <h3> <%= User.find(pending_booking_as_owner.user_id).username wants to rent your pet <%= Pet.find(pending_booking_as_owner.pet_id).name  </h3> %>
          <%# <p>From: <%= pending_booking_as_owner.starting_date.strftime("%a %e %b %y")</p> %>
          <%# <p>To: <%= pending_booking_as_owner.ending_date.strftime("%a %e %b %y") </p> <br> %>
          <%# Accept or decline here. <br> %>
          <%# <p>Price: <%= ((pending_booking_as_owner.ending_date - pending_booking_as_owner.starting_date)/86400) * Pet.find(pending_booking_as_owner.pet_id).price€</p> %>
          <%# <%= simple_form_for(pending_booking_as_owner) do |t| %>
            <%# <%= t.input :status, as: :select, collection: Booking.statuses.keys, selected: 1, required: true %>
            <%# <%= t.submit  %>
          <%# <% end %>
      <%# </div> %>
    <%# <% end %>
  <%# </div> %>

  <%# <div class="card-dashboard"> %>
    <%# <h1>Accepted Bookings as a user(<%= @accepted_bookings.count)</h1> %>
    <%# <h3> This is the list of pets that you can go pick up on due date</h3> %>
    <%# <% @accepted_bookings.each do |accepted_booking| %>
      <%# <div class="card-accepted-booking"> %>
        <%# Booking confirmed. You can get your new pet <%= Pet.find(accepted_booking.pet_id).name ! <br> %>
        <%# <p>From: <%= accepted_booking.starting_date.strftime("%a %e %b %y")</p> %>
        <%# <p>To: <%= accepted_booking.ending_date.strftime("%a %e %b %y") </p> %>
        <%# <p>Price: <%= ((accepted_booking.ending_date - accepted_booking.starting_date)/86400) * Pet.find(accepted_booking.pet_id).price€</p> %>
        <%# <%= link_to "Show booking", booking_path(accepted_booking), class: "btn btn-light" %>
      <%# </div> %>
    <%# <% end %>
  <%# </div> %>

  <%# <div class="card-dashboard"> %>
    <%# <h1>Accepted bookings as a owner (<%= @accepted_bookings_as_owner.count)</h1> %>
    <%# <h3>Congratulations, you have  <%= @accepted_bookings_as_owner.count pets of yours that are being booked</h3> %>
    <%# <% @accepted_bookings_as_owner.each do |accepted_booking_as_owner| %>
      <%# <div class="card-accepted-booking"> %>
        <%# Booking confirmed. You can get your new pet <%= Pet.find(accepted_booking_as_owner.pet_id).name ! <br> %>
        <%# <p>From: <%= accepted_booking_as_owner.starting_date.strftime("%a %e %b %y")</p> %>
        <%# <p>To: <%= accepted_booking_as_owner.ending_date.strftime("%a %e %b %y") </p> %>
        <%# <p>Price: <%= ((accepted_booking_as_owner.ending_date - accepted_booking_as_owner.starting_date)/86400) * Pet.find(accepted_booking_as_owner.pet_id).price€</p> %>
      <%# </div> %>
    <%# <% end %>
  <%# </div> %>
